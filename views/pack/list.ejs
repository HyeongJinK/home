<div id="bookList"></div>
<table class="table table-sm table-dark table-hover">
    <tbody>
    </tbody>
</table>

<div class="input-group mb-3">
  <input type="text" class="form-control" placeholder="Search" id="searchText">
  <div class="input-group-append">
    <button class="btn btn-success searchBt" type="button">검색</button> 
  </div>
</div>

<ul class="pagination justify-content-center">
</ul>


<script>
    $(document).ready(function () {
        const rows = 20;

        $("button.searchBt").click(function() {
            getListData(1, rows, $("input#searchText").val());
           
        });

        function drawTable(data) {

            $("table tbody").html("");
            $(data.books).each(function (index) {
                let $tr = $("<tr></tr>");
                $tr.append($("<td><img src='" + this.imgUrl + "'></td>"));
                $tr.append($("<td>" + this.title + "<br /><br />"+this.description+"</td>"));
                $tr.append($("<td>" + this.publicationDate + "</td>"));
                let isbn = this.isbn;
                $tr.on('click', function() {
                    location.href="/pack/"+isbn
                });
                $("table tbody").append($tr);
            });
        }

        function drawPagination(data, pageNum, rowNum, searchText) {
            $("ul.pagination").html("");
            let totalPage = parseInt(data.bookCount / rowNum + (data.bookCount % rowNum == 0 ? 0 : 1));
            
            let startPage = pageNum - 4;
            if (pageNum < 6) {
                startPage = 1;
            } else if (pageNum + 4 > totalPage) {
                startPage = totalPage - 9;
            }

            let finishPage = startPage + 9;
            if (totalPage < startPage + 9) {
                finishPage = totalPage;
            }
            
            for (let i = startPage; i <= finishPage; i++) {
                let $li = $("<li></li>");
                $li.addClass("page-item");
                if (i == pageNum) {
                    $li.addClass("active");
                }
                let $a = $("<a href='#'>" +i+ "</a>");
                $a.addClass("page-link");
                $a.on('click', function() {
                    getListData(i, rows, searchText);
                });
                $li.append($a);

                $("ul.pagination").append($li);
            }
        }

        function getListData(pageNum, rowNum, searchText) {
            $.getJSON('/pack/list', {"pageNum" : pageNum , "rowNum" : rowNum, "searchText" : searchText}, function (data) {
                //테이블 그리기
                drawTable(data);
                //페이징
                drawPagination(data, pageNum, rowNum, searchText);
            });
        }

        getListData(1, rows, "");
    });
</script>